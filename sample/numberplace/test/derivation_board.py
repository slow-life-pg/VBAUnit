from vbaunit_lib.testlib import gettestlib, expect, expect_equals  # noqa


def get_problemboard_easy() -> list[list[int]]:
    # Very easy Sudoku (about 50% filled)
    # 5 1 . | 4 . 2 | 8 . 9
    # . 9 4 | . 8 . | . 1 6
    # 7 . 2 | . . 9 | . 4 .
    # ------+-------+------
    # 9 4 5 | 7 . . | 1 . 8
    # 1 . . | 9 . 5 | . . 4
    # 8 . 7 | . . 4 | 6 9 2
    # ------+-------+------
    # . 7 . | 2 . . | 4 . 1
    # 2 6 . | . 9 . | 7 8 .
    # 4 . 9 | 8 . 7 | . 2 5

    # Python 代入文（空白セルは 0 で埋める）
    problem = [
        [5, 1, 0, 4, 0, 2, 8, 0, 9],
        [0, 9, 4, 0, 8, 0, 0, 1, 6],
        [7, 0, 2, 0, 0, 9, 0, 4, 0],
        [9, 4, 5, 7, 0, 0, 1, 0, 8],
        [1, 0, 0, 9, 0, 5, 0, 0, 4],
        [8, 0, 7, 0, 0, 4, 6, 9, 2],
        [0, 7, 0, 2, 0, 0, 4, 0, 1],
        [2, 6, 0, 0, 9, 0, 7, 8, 0],
        [4, 0, 9, 8, 0, 7, 0, 2, 5],
    ]

    return problem


def test_copyboard():
    testlib = gettestlib()
    problem = get_problemboard_easy()
    expectation = (
        (5, 1, 0, 4, 0, 2, 8, 0, 9),
        (0, 9, 4, 0, 8, 0, 0, 1, 6),
        (7, 0, 2, 0, 0, 9, 0, 4, 0),
        (9, 4, 5, 7, 0, 0, 1, 0, 8),
        (1, 0, 0, 9, 0, 5, 0, 0, 4),
        (8, 0, 7, 0, 0, 4, 6, 9, 2),
        (0, 7, 0, 2, 0, 0, 4, 0, 1),
        (2, 6, 0, 0, 9, 0, 7, 8, 0),
        (4, 0, 9, 8, 0, 7, 0, 2, 5),
    )

    with testlib.runapp("..\\product\\NumberPlaceSolver.xlsm"):
        currentboard = testlib.getdynamicarray(0, 8, 0, 8)
        res = testlib.callmacro(None, "CopyBoard", currentboard, problem)
        expect_equals(expectation, res[1])


def test_derive_candidates_onboard_solved():
    testlib = gettestlib()
    problem = [[1 for _ in range(9)] for _ in range(9)]  # Any value can be used for the setting.

    with testlib.runapp("..\\product\\NumberPlaceSolver.xlsm"):
        candidates = testlib.getcollectionobj()
        res = testlib.callmacro(None, "DeriveCandidates", candidates, problem)
        expect_equals(0, res[3], "COM Error")
        expect_equals(0, res[0], "Cell count")
        expect_equals(0, candidates.Count())


def test_derive_candidates_onboard_halfway():
    testlib = gettestlib()
    problem = get_problemboard_easy()

    with testlib.runapp("..\\product\\NumberPlaceSolver.xlsm"):
        candidates = testlib.getcollectionobj()
        res = testlib.callmacro(None, "DeriveCandidates", candidates, problem)
        expect_equals(0, res[3], "COM Error")
        expect_equals(35, res[0], "Cell count")
        expect_equals(71, candidates.Count())
        candidate = candidates.Item(1)
        expect_equals(1, candidate.Row)
        expect_equals(3, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(2)
        expect_equals(1, candidate.Row)
        expect_equals(3, candidate.Column)
        expect_equals(6, candidate.Fill)
        candidate = candidates.Item(3)
        expect_equals(1, candidate.Row)
        expect_equals(5, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(4)
        expect_equals(1, candidate.Row)
        expect_equals(5, candidate.Column)
        expect_equals(6, candidate.Fill)
        candidate = candidates.Item(5)
        expect_equals(1, candidate.Row)
        expect_equals(5, candidate.Column)
        expect_equals(7, candidate.Fill)
        candidate = candidates.Item(6)
        expect_equals(1, candidate.Row)
        expect_equals(8, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(7)
        expect_equals(1, candidate.Row)
        expect_equals(8, candidate.Column)
        expect_equals(7, candidate.Fill)
        candidate = candidates.Item(8)
        expect_equals(2, candidate.Row)
        expect_equals(1, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(9)
        expect_equals(2, candidate.Row)
        expect_equals(4, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(10)
        expect_equals(2, candidate.Row)
        expect_equals(4, candidate.Column)
        expect_equals(5, candidate.Fill)
        candidate = candidates.Item(11)
        expect_equals(2, candidate.Row)
        expect_equals(6, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(12)
        expect_equals(2, candidate.Row)
        expect_equals(7, candidate.Column)
        expect_equals(2, candidate.Fill)
        candidate = candidates.Item(13)
        expect_equals(2, candidate.Row)
        expect_equals(7, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(14)
        expect_equals(2, candidate.Row)
        expect_equals(7, candidate.Column)
        expect_equals(5, candidate.Fill)
        candidate = candidates.Item(15)
        expect_equals(3, candidate.Row)
        expect_equals(2, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(16)
        expect_equals(3, candidate.Row)
        expect_equals(2, candidate.Column)
        expect_equals(8, candidate.Fill)
        candidate = candidates.Item(17)
        expect_equals(3, candidate.Row)
        expect_equals(4, candidate.Column)
        expect_equals(1, candidate.Fill)
        candidate = candidates.Item(18)
        expect_equals(3, candidate.Row)
        expect_equals(4, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(19)
        expect_equals(3, candidate.Row)
        expect_equals(4, candidate.Column)
        expect_equals(5, candidate.Fill)
        candidate = candidates.Item(20)
        expect_equals(3, candidate.Row)
        expect_equals(4, candidate.Column)
        expect_equals(6, candidate.Fill)
        candidate = candidates.Item(21)
        expect_equals(3, candidate.Row)
        expect_equals(5, candidate.Column)
        expect_equals(1, candidate.Fill)
        candidate = candidates.Item(22)
        expect_equals(3, candidate.Row)
        expect_equals(5, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(23)
        expect_equals(3, candidate.Row)
        expect_equals(5, candidate.Column)
        expect_equals(5, candidate.Fill)
        candidate = candidates.Item(24)
        expect_equals(3, candidate.Row)
        expect_equals(5, candidate.Column)
        expect_equals(6, candidate.Fill)
        candidate = candidates.Item(25)
        expect_equals(3, candidate.Row)
        expect_equals(7, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(26)
        expect_equals(3, candidate.Row)
        expect_equals(7, candidate.Column)
        expect_equals(5, candidate.Fill)
        candidate = candidates.Item(27)
        expect_equals(3, candidate.Row)
        expect_equals(9, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(28)
        expect_equals(4, candidate.Row)
        expect_equals(5, candidate.Column)
        expect_equals(2, candidate.Fill)
        candidate = candidates.Item(29)
        expect_equals(4, candidate.Row)
        expect_equals(5, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(30)
        expect_equals(4, candidate.Row)
        expect_equals(5, candidate.Column)
        expect_equals(6, candidate.Fill)
        candidate = candidates.Item(31)
        expect_equals(4, candidate.Row)
        expect_equals(6, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(32)
        expect_equals(4, candidate.Row)
        expect_equals(6, candidate.Column)
        expect_equals(6, candidate.Fill)
        candidate = candidates.Item(33)
        expect_equals(4, candidate.Row)
        expect_equals(8, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(34)
        expect_equals(5, candidate.Row)
        expect_equals(2, candidate.Column)
        expect_equals(2, candidate.Fill)
        candidate = candidates.Item(35)
        expect_equals(5, candidate.Row)
        expect_equals(2, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(36)
        expect_equals(5, candidate.Row)
        expect_equals(3, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(37)
        expect_equals(5, candidate.Row)
        expect_equals(3, candidate.Column)
        expect_equals(6, candidate.Fill)
        candidate = candidates.Item(38)
        expect_equals(5, candidate.Row)
        expect_equals(5, candidate.Column)
        expect_equals(2, candidate.Fill)
        candidate = candidates.Item(39)
        expect_equals(5, candidate.Row)
        expect_equals(5, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(40)
        expect_equals(5, candidate.Row)
        expect_equals(5, candidate.Column)
        expect_equals(6, candidate.Fill)
        candidate = candidates.Item(41)
        expect_equals(5, candidate.Row)
        expect_equals(7, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(42)
        expect_equals(5, candidate.Row)
        expect_equals(8, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(43)
        expect_equals(5, candidate.Row)
        expect_equals(8, candidate.Column)
        expect_equals(7, candidate.Fill)
        candidate = candidates.Item(44)
        expect_equals(6, candidate.Row)
        expect_equals(2, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(45)
        expect_equals(6, candidate.Row)
        expect_equals(4, candidate.Column)
        expect_equals(1, candidate.Fill)
        candidate = candidates.Item(46)
        expect_equals(6, candidate.Row)
        expect_equals(4, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(47)
        expect_equals(6, candidate.Row)
        expect_equals(5, candidate.Column)
        expect_equals(1, candidate.Fill)
        candidate = candidates.Item(48)
        expect_equals(6, candidate.Row)
        expect_equals(5, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(49)
        expect_equals(7, candidate.Row)
        expect_equals(1, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(50)
        expect_equals(7, candidate.Row)
        expect_equals(3, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(51)
        expect_equals(7, candidate.Row)
        expect_equals(3, candidate.Column)
        expect_equals(8, candidate.Fill)
        candidate = candidates.Item(52)
        expect_equals(7, candidate.Row)
        expect_equals(5, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(53)
        expect_equals(7, candidate.Row)
        expect_equals(5, candidate.Column)
        expect_equals(5, candidate.Fill)
        candidate = candidates.Item(54)
        expect_equals(7, candidate.Row)
        expect_equals(5, candidate.Column)
        expect_equals(6, candidate.Fill)
        candidate = candidates.Item(55)
        expect_equals(7, candidate.Row)
        expect_equals(6, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(56)
        expect_equals(7, candidate.Row)
        expect_equals(6, candidate.Column)
        expect_equals(6, candidate.Fill)
        candidate = candidates.Item(57)
        expect_equals(7, candidate.Row)
        expect_equals(8, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(58)
        expect_equals(7, candidate.Row)
        expect_equals(8, candidate.Column)
        expect_equals(6, candidate.Fill)
        candidate = candidates.Item(59)
        expect_equals(8, candidate.Row)
        expect_equals(3, candidate.Column)
        expect_equals(1, candidate.Fill)
        candidate = candidates.Item(60)
        expect_equals(8, candidate.Row)
        expect_equals(3, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(61)
        expect_equals(8, candidate.Row)
        expect_equals(4, candidate.Column)
        expect_equals(1, candidate.Fill)
        candidate = candidates.Item(62)
        expect_equals(8, candidate.Row)
        expect_equals(4, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(63)
        expect_equals(8, candidate.Row)
        expect_equals(4, candidate.Column)
        expect_equals(5, candidate.Fill)
        candidate = candidates.Item(64)
        expect_equals(8, candidate.Row)
        expect_equals(6, candidate.Column)
        expect_equals(1, candidate.Fill)
        candidate = candidates.Item(65)
        expect_equals(8, candidate.Row)
        expect_equals(6, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(66)
        expect_equals(8, candidate.Row)
        expect_equals(9, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(67)
        expect_equals(9, candidate.Row)
        expect_equals(2, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(68)
        expect_equals(9, candidate.Row)
        expect_equals(5, candidate.Column)
        expect_equals(1, candidate.Fill)
        candidate = candidates.Item(69)
        expect_equals(9, candidate.Row)
        expect_equals(5, candidate.Column)
        expect_equals(3, candidate.Fill)
        candidate = candidates.Item(70)
        expect_equals(9, candidate.Row)
        expect_equals(5, candidate.Column)
        expect_equals(6, candidate.Fill)
        candidate = candidates.Item(71)
        expect_equals(9, candidate.Row)
        expect_equals(7, candidate.Column)
        expect_equals(3, candidate.Fill)
